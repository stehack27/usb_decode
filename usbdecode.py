import sys

caps_lock = False
KEYS = {
    0: '',
    1: '',
    2: '',
    3: '',
    4: 'a',
    5: 'b',
    6: 'c',
    7: 'd',
    8: 'e',
    9: 'f',
    10: 'g',
    11: 'h',
    12: 'i',
    13: 'j',
    14: 'k',
    15: 'l',
    16: 'm',
    17: 'n',
    18: 'o',
    19: 'p',
    20: 'q',
    21: 'r',
    22: 's',
    23: 't',
    24: 'u',
    25: 'v',
    26: 'w',
    27: 'x',
    28: 'y',
    29: 'z',
    30: '1',
    31: '2',
    32: '3',
    33: '4',
    34: '5',
    35: '6',
    36: '7',
    37: '8',
    38: '9',
    39: '0',
    40: 'Enter',
    41: 'Esc',
    42: 'BSp',
    43: 'Tab',
    44: 'Space',
    45: '- / _',
    46: '= / +',
    47: '[ / {',
    48: '] / }',
    49: '\\ / |',
    50: '...',
    51: '; / :',
    52: '\' / "',
    53: '` / ~',
    54: ', / <',
    55: '. / >',
    56: '/ / ?',
    57: 'Caps Lock',
    58: '[F1]',
    59: '[F2]',
    60: '[F3]',
    61: '[F4]',
    62: '[F5]',
    63: '[F6]',
    64: '[F7]',
    65: '[F8]',
    66: '[F9]',
    67: '[F10]',
    68: '[F11]',
    69: '[F12]',
    70: '[PrtScr]',
    71: '[Scroll Lock]',
    72: '[Pause]',
    73: '[Insert]',
    74: '[Home]',
    75: '[PgUp]',
    76: 'Delete',
    77: '[End]',
    78: '[PgDn]',
    79: '[Right]',
    80: '[Left]',
    81: '[Down]',
    82: '[Up]',
    83: '[Num Lock]',
    84: '[KP /]',
    85: '[KP *]',
    86: '[KP -]',
    87: '[KP +]',
    88: '[KP Enter]',
    89: '[KP 1 / End]',
    90: '[KP 2 / Down]',
    91: '[KP 3 / PgDn]',
    92: '[KP 4 / Left]',
    93: '[KP 5]',
    94: '[KP 6 / Right]',
    95: '[KP 7 / Home]',
    96: '[KP 8 / Up]',
    97: '[KP 9 / PgUp]',
    98: '[KP 0 / Ins]',
    99: '[KP . / Del]',
    100: '...',
    101: '[Applic]',
    102: '[Power]',
    103: '[KP =]',
    104: '[F13]',
    105: '[F14]',
    106: '[F15]',
    107: '[F16]',
    108: '[F17]',
    109: '[F18]',
    110: '[F19]',
    111: '[F20]',
    112: '[F21]',
    113: '[F22]',
    114: '[F23]',
    115: '[F24]',
    116: '[Execute]',
    117: '[Help]',
    118: '[Menu]',
    119: '[Select]',
    120: '[Stop]',
    121: '[Again]',
    122: '[Undo]',
    123: '[Cut]',
    124: '[Copy]',
    125: '[Paste]',
    126: '[Find]',
    127: '[Mute]',
    128: '[Volume Up]',
    129: '[Volume Down]',
    130: '[Locking Caps Lock]',
    131: '[Locking Num Lock]',
    132: '[Locking Scroll Lock]',
    133: '[KP ,]',
    134: '[KP =]',
    135: '[Internat]',
    136: '[Internat]',
    137: '[Internat]',
    138: '[Internat]',
    139: '[Internat]',
    140: '[Internat]',
    141: '[Internat]',
    142: '[Internat]',
    143: '[Internat]',
    144: '[LANG]',
    145: '[LANG]',
    146: '[LANG]',
    147: '[LANG]',
    148: '[LANG]',
    149: '[LANG]',
    150: '[LANG]',
    151: '[LANG]',
    152: '[LANG]',
    153: '[Alt Erase]',
    154: '[SysRq]',
    155: '[Cancel]',
    156: '[Clear]',
    157: '[Prior]',
    158: 'Return',
    159: '[Separ]',
    160: '[Out]',
    161: '[Oper]',
    162: '[Clear / Again]',
    163: '[CrSel / Props]',
    164: '[ExSel]',
    165: '',
    166: '',
    167: '',
    224: '[LCtrl]',
    225: '[LShift]',
    226: '[LAlt]',
    227: '[LGUI]',
    228: '[RCtrl]',
    229: '[RShift]',
    230: '[RAlt]',
    231: '[RGUI]'
}

text = ""

for line in open(sys.argv[1],"r"):
    if "Leftover Capture Data" in line:
        #Extract keycode bytes
        num = int(line.replace('Leftover Capture Data: ','')[4:6],16)
        #Toggle caps lock
        char = KEYS[num]
        if char == "Caps Lock":
            caps_lock = not caps_lock

        #Build string
        elif char == "Space":
            text += " "
        elif char == "Enter" or char == "Return":
            text += "\n"
        elif char == "Delete":
            text = text[:-1]
        else:
            if caps_lock:
                text += char.upper()
            else:
                text += char

print(text)

